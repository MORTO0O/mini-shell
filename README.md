# Лабораторная работа №2

## Вариант без поддержки архивации.

* **Тема:** Мини-оболочка с файловыми командами
* **Цель:** Освоить работу с файловой системой средствами Python и реализовать базовые команды управления файлами, каталогами и историей действий, научиться вести журнал действий пользователя, (medium) освоить расширение функциональности за счет доп. модулей-плагинов.
* **Библиотеки:** *os*, *pathlib*, *shutil*, *logging*, *re*, *unittest*

---

### **Функционал**

#### **Обязательные команды Easy уровня**

| Команда                 | Назначение                                                                                                                    |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| **ls [path]**           | Отображение списка файлов и каталогов в указанном или текущем каталоге.                                                       |
| **cd [path]**           | Переход в указанный каталог. Поддержка `..`, `~`, `/`.                                                                        |
| **cat <file>**          | Вывод содержимого файла.                                                                                                      |
| **cp [-r] <src> <dst>** | Копирование файла или каталога (`-r` - рекурсивно).                                                                           |
| **mv <src> <dst>**      | Перемещение или переименование файла/каталога. Поддержка перемещения в существующий каталог.                                  |
| **rm [-r] <path>**      | Удаление файла или каталога (`-r` - рекурсивно, с подтверждением). Каталоги не удаляются без `-r`. Нельзя удалить `/` и `..`. |
| **exit**                | Завершение работы оболочки.                                                                                                   |

#### **Дополнительные команды Medium уровня и немного отсебятины)**

| Команда                             | Назначение                                                                                                              |
| ----------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| **grep [-r] [-i] <pattern> <path>** | Поиск строк, соответствующих шаблону `pattern`, в файлах каталога. `-r` - рекурсивный поиск, `-i` - без учёта регистра. |
| **history [n] [--clear]**           | Вывод последних `n` команд из истории. Опция `--clear` очищает историю.                                                 |
| **undo**                            | Отмена последнего действия (`cp`, `mv`, `rm`, `touch`, `mkdir`).                                                        |
| **touch <file>**                    | Создание нового файла или обновление timestamp существующего.                                                           |
| **mkdir <dir>**                     | Создание новой директории.                                                                                              |

---

### **Особенности реализации**

1. Все операции выполняются средствами **Python API**, без внешних оболочек или запуска системных команд (`subprocess`).
2. Поддержка **относительных и абсолютных путей**.
3. **Логирование** всех команд, успехов и ошибок в файл `shell.log` (в домашнем каталоге пользователя).
   Формат лога:
   ```
   [2025-10-01 13:45:22] Command: ls -l /home/user
   [2025-10-01 13:45:23] Success: ls -l /home/user
   [2025-10-01 13:45:24] Error: No such file or directory
   ```
4. Наличие **истории команд** в файле `.history` (счётчик хранится в `.history_counter`).
5. Реализована **корзина `.trash`** в домашней директории, из которой можно восстановить удалённые объекты с помощью `undo`.
6. Команды `cp`, `mv`, `rm`, `touch`, `mkdir` создают записи для возможного отката.
7. Обработка ошибок (отсутствие файла, прав, некорректный путь, запрет удаления `/` и `..`).

---

### **Чему я научился**

* Работать с файловой системой через модули `os`, `pathlib`, `shutil`.
* Использовать **логирования** (`logging`) для записи действий и ошибок.
* Применять **исключений (try/except)** для безопасного выполнения операций.
* Организовывать **истории и undo-механизма** через файлы.
* Тестировать код с помощью `unittest` и `mock`.
* Проектировать CLI-приложения с обработкой аргументов команд.

---

### **Алгоритм работы оболочки**

1. При запуске создаются файлы истории и каталог `.trash`.
2. Пользователь вводит команду (например `cp file1.txt file2.txt`).
3. Ввод разбивается на токены через `shlex.split()`.
4. Выполняется соответствующая функция из `CmdHandlers`
5. Результат записывается в лог и историю.
6. При ошибках сообщение выводится в консоль и логируется как `ERROR:`.
7. Команды `undo` и `history` позволяют просматривать и откатывать действия.

---

### **Инструкция по запуску**

1. **Клонирование репозитория:**

   ```bash
   git clone https://github.com/MORTO0O/mini_shell
   cd mini_shell
   ```

2. **Создание виртуального окружения:**

   ```bash
   python -m venv venv
   source venv/Scripts/activate  # Windows
   # или
   source venv/bin/activate      # Linux/macOS
   ```

3. **Установка зависимостей:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Запуск оболочки:**

   ```bash
   python -m src.main
   ```

5. **Запуск тестов:**

   ```bash
   python -m unittest discover -s tests -v
   ```

